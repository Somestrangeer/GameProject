using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.SceneManagement;
using System.IO;
using System.Text;
using System.Text.Json;



[System.Serializable]
public class SaveData
{
    public Vector3 position;
    public float health;
    public string sceneName;
    public string stringValue;
}

public class SaveSystem : MonoBehaviour
{
    private const string saveFileName = "saveFile.json";

    public static void SaveGame(Hero player)
    {
        SaveData data = new SaveData();

        // ????????? ?????? ??????
        data.position = player.transform.position;
        data.health = player.getHp();
        data.sceneName = SceneManager.GetActiveScene().name;
        data.stringValue = "???????????? ????????? ????????"; // ???????? ?? ???? ????????

        // ??????????? ?????? ? JSON
        string jsonString = JsonSerializer.Serialize(data);

        // ????????? JSON-?????? ? ????
        string path = Application.persistentDataPath + "/" + saveFileName;
        File.WriteAllText(path, jsonString);
    }

    public static SaveData LoadGame()
    {
        // ????????? JSON-?????? ?? ?????
        string path = Application.persistentDataPath + "/" + saveFileName;
        if (File.Exists(path))
        {
            string jsonString = File.ReadAllText(path);

            // ????????????? ?????? ?? JSON
            SaveData data = JsonSerializer.Deserialize<SaveData>(jsonString);
            return data;
        }
        else
        {
            return null;
        }
    }

    public static void LoadAndRestore(GameObject player)
    {
        SaveData data = LoadGame();
        if (data != null)
        {
            // ????????? ?? ?????? ?????
            SceneManager.LoadScene(data.sceneName);

            // ????, ???? ????? ??????????
            while (!SceneManager.GetActiveScene().isLoaded) { }

            // ????????????? ????????? ??????
            player.transform.position = data.position;
            player.GetComponent<Health>().currentHealth = data.health;
        }
    }

}
